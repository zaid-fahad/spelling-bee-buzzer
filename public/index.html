<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>4-Player Buzzer Game</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Geologica:wght@400;700&display=swap');

  body {
    font-family: 'Geologica', Arial, sans-serif;
    background: #111;
    color: #fff;
    text-align: center;
    margin: 0;
    padding: 20px;
  }

  h1 {
    font-size: 48px;
    color: #f0a500;
    text-shadow: 0 0 10px #f0a500;
    margin-bottom: 10px;
  }

  #info {
    font-size: 22px;
    margin-bottom: 20px;
  }

  #players-container {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 30px;
  }

  .player-card {
    min-width: 140px;
    padding: 20px;
    border-radius: 15px;
    background: #222;
    color: #fff;
    font-size: 24px;
    font-weight: bold;
    box-shadow: 0 0 10px #000;
    transition: all 0.3s ease;
  }

  .player-card.active {
    transform: scale(1.2);
    background: #f0a500;
    color: #111;
    box-shadow: 0 0 20px #f0a500;
  }

  .player-card.buzzed {
    opacity: 0.8;
    background: #444;
  }

  table {
    margin: 0 auto;
    border-collapse: collapse;
    width: 90%;
    max-width: 700px;
    font-size: 20px;
  }

  th, td {
    border: 1px solid #f0a500;
    padding: 10px;
    text-align: center;
  }

  th {
    background: #222;
    color: #f0a500;
  }

  td {
    background: #111;
    color: #fff;
  }

  #controls {
    margin-top: 30px;
  }

  button {
    margin: 10px;
    padding: 15px 25px;
    font-size: 20px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    background: #f0a500;
    color: #111;
    font-weight: bold;
    box-shadow: 0 5px #c47f00;
    transition: all 0.2s ease;
  }

  button:active {
    transform: translateY(2px);
    box-shadow: 0 3px #c47f00;
  }

  @media (max-width: 600px) {
    .player-card { font-size: 18px; min-width: 100px; padding: 15px; }
    table { font-size: 16px; }
    button { font-size: 16px; padding: 12px 20px; }
  }
</style>
</head>
<body>

<h1>4-Player Buzzer Game</h1>

<div id="info">
  Round: <span id="round-number">1</span> | Winner: <span id="winner">—</span>
</div>

<div id="players-container">
  <div class="player-card" id="p1">P1<br><span class="timestamp">—</span></div>
  <div class="player-card" id="p2">P2<br><span class="timestamp">—</span></div>
  <div class="player-card" id="p3">P3<br><span class="timestamp">—</span></div>
  <div class="player-card" id="p4">P4<br><span class="timestamp">—</span></div>
</div>

<h2>Buzz Queue</h2>
<table>
  <thead>
    <tr>
      <th>Order</th>
      <th>Player</th>
      <th>Timestamp</th>
    </tr>
  </thead>
  <tbody id="queue-body">
    <tr><td colspan="3">No buzzers yet</td></tr>
  </tbody>
</table>

<div id="controls">
  <button onclick="send('RESET')">Reset</button>
  <button onclick="send('NEXT')">Next Player</button>
</div>

<script>
const ws = new WebSocket("ws://localhost:9394");
const playerDivs = [
  null,
  document.getElementById('p1'),
  document.getElementById('p2'),
  document.getElementById('p3'),
  document.getElementById('p4')
];
const queueBody = document.getElementById('queue-body');
const roundNumberSpan = document.getElementById('round-number');
const winnerSpan = document.getElementById('winner');

let playerTimestamps = [null, null, null, null, null];
let roundNumber = 1;

function getTimestamp() {
  const d = new Date();
  return d.toLocaleTimeString() + '.' + d.getMilliseconds().toString().padStart(3,'0');
}

ws.onopen = () => console.log("WS Connected");

ws.onmessage = (msg) => {
  const data = JSON.parse(msg.data);

  // Reset all player cards
  for (let i=1;i<=4;i++){
    playerDivs[i].classList.remove('active','buzzed');
    playerDivs[i].querySelector('.timestamp').textContent = playerTimestamps[i] || '—';
  }

  if (data.type === "queue") {
    const queue = data.queue || [];

    // Update timestamps and status
    queue.forEach((p, idx) => {
      if (!playerTimestamps[p]) playerTimestamps[p] = getTimestamp();
      if (idx === 0) {
        playerDivs[p].classList.add('active');
        winnerSpan.textContent = `P${p}`;
      } else {
        playerDivs[p].classList.add('buzzed');
      }
      playerDivs[p].querySelector('.timestamp').textContent = playerTimestamps[p];
    });

    // Update table
    queueBody.innerHTML = "";
    if(queue.length === 0){
      const tr = document.createElement('tr');
      tr.innerHTML = `<td colspan="3">No buzzers yet</td>`;
      queueBody.appendChild(tr);
      winnerSpan.textContent = '—';
    } else {
      queue.forEach((p, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${idx+1}</td><td>P${p}</td><td>${playerTimestamps[p]}</td>`;
        queueBody.appendChild(tr);
      });
    }
  }
};

function send(msg){
  if(msg === 'RESET') {
    roundNumber++;
    roundNumberSpan.textContent = roundNumber;
    playerTimestamps = [null, null, null, null, null];
    winnerSpan.textContent = '—';
  }
  ws.send(msg);
}
</script>

</body>
</html>
